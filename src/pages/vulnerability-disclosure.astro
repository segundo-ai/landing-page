---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Footer from "@/components/Footer.astro";
import { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList, BreadcrumbPage, BreadcrumbSeparator } from "@/components/starwind/breadcrumb";
import { Card, CardContent } from "@/components/starwind/card";
import { Button } from "@/components/starwind/button";
import { Input } from "@/components/starwind/input";
import { Label } from "@/components/starwind/label";
import { defaultLang } from "@/config/i18n";
import { site } from "@/config/site";
import { CONTACT_FORM_SECRETS } from "@/utils/secrets";

const { FORMSPARK_ENDPOINT, BOTPOISON_PUBLIC_KEY } = CONTACT_FORM_SECRETS;
const lang = defaultLang;
const pageTitle = "Vulnerability Disclosure | Primero AI";
const pageDescription = "Public vulnerability disclosure process for Primero AI.";
const pageName = "Vulnerability Disclosure";
const securityEmail = "security@primero.ai";
---

<BaseLayout title={pageTitle} description={pageDescription} lang={lang}>
  <main class="bg-background min-h-screen">
    <nav class="w-full px-4 sm:px-6 lg:px-8 pt-8 pb-4" aria-label="Breadcrumb">
      <div class="max-w-4xl mx-auto">
        <Breadcrumb>
          <BreadcrumbList>
            <BreadcrumbItem>
              <BreadcrumbLink href="/">Home</BreadcrumbLink>
            </BreadcrumbItem>
            <BreadcrumbSeparator />
            <BreadcrumbItem>
              <BreadcrumbPage>{pageName}</BreadcrumbPage>
            </BreadcrumbItem>
          </BreadcrumbList>
        </Breadcrumb>
      </div>
    </nav>

    <article class="w-full px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
      <div class="max-w-4xl mx-auto 
                  [&_h1]:text-3xl [&_h1]:sm:text-4xl [&_h1]:lg:text-5xl [&_h1]:mb-6 [&_h1]:mt-0 [&_h1]:nohemi-semibold [&_h1]:text-foreground
                  [&_h2]:text-2xl [&_h2]:sm:text-3xl [&_h2]:lg:text-4xl [&_h2]:mt-8 [&_h2]:mb-4 [&_h2]:nohemi-semibold [&_h2]:text-foreground
                  [&_h3]:text-xl [&_h3]:sm:text-2xl [&_h3]:lg:text-3xl [&_h3]:mt-6 [&_h3]:mb-3 [&_h3]:nohemi-semibold [&_h3]:text-foreground
                  [&_h4]:text-lg [&_h4]:sm:text-xl [&_h4]:lg:text-2xl [&_h4]:mt-4 [&_h4]:mb-2 [&_h4]:nohemi-semibold [&_h4]:text-foreground
                  [&_p]:text-muted-foreground [&_p]:leading-relaxed [&_p]:mb-4
                  [&_a]:text-primary [&_a]:no-underline hover:[&_a]:underline
                  [&_strong]:text-foreground [&_strong]:nohemi-semibold [&_strong]:font-semibold
                  [&_ul]:text-muted-foreground [&_ul]:list-disc [&_ul]:pl-6 [&_ul]:mb-4 [&_ul]:space-y-2
                  [&_ol]:text-muted-foreground [&_ol]:list-decimal [&_ol]:pl-6 [&_ol]:mb-4 [&_ol]:space-y-2
                  [&_li]:leading-relaxed
                  [&_table]:w-full [&_table]:border-collapse [&_table]:my-6
                  [&_th]:border [&_th]:border-border [&_th]:p-3 [&_th]:bg-card [&_th]:text-left [&_th]:text-foreground [&_th]:nohemi-semibold
                  [&_td]:border [&_td]:border-border [&_td]:p-3 [&_td]:text-muted-foreground
                  [&_blockquote]:border-l-4 [&_blockquote]:border-primary [&_blockquote]:pl-4 [&_blockquote]:italic [&_blockquote]:text-muted-foreground [&_blockquote]:my-4
                  [&_code]:bg-card [&_code]:px-1.5 [&_code]:py-0.5 [&_code]:rounded [&_code]:text-sm [&_code]:text-foreground
                  [&_pre]:bg-card [&_pre]:p-4 [&_pre]:rounded-lg [&_pre]:overflow-x-auto [&_pre]:my-4
                  [&_pre_code]:bg-transparent [&_pre_code]:p-0
                  [&_hr]:border-border [&_hr]:my-8">
        <h1>Vulnerability Disclosure</h1>
        <p>
          Primero AI welcomes responsible disclosure of security vulnerabilities. If you believe you have found a security issue,
          please report it so we can investigate and fix it.
        </p>
        <p>
          Prefer email? Reach us at <a href={`mailto:${securityEmail}`}>{securityEmail}</a>.
        </p>

        <Card class="p-6 lg:p-8 shadow-lg">
          <CardContent class="p-0">
            <form
              id="vulnerability-form"
              class="space-y-6"
              method="POST"
              action="javascript:void(0);"
              data-formspark-endpoint={FORMSPARK_ENDPOINT}
              data-botpoison-public-key={BOTPOISON_PUBLIC_KEY}
              data-require-contact="false"
              data-email-to={securityEmail}
              data-success-message="Thanks — we’ve received your report."
            >
              <input type="hidden" name="Report Type" value="Vulnerability Disclosure" />
              <input type="hidden" name="Company" value={site.name} />

              <div class="space-y-2">
                <Label for="reporter-name" size="sm">Name / Handle (optional)</Label>
                <Input id="reporter-name" name="Name" type="text" placeholder="Jane Doe" size="md" />
              </div>

              <div class="space-y-2">
                <Label for="reporter-email" size="sm">Email (optional)</Label>
                <Input id="reporter-email" name="Email" type="email" placeholder="you@example.com" size="md" />
              </div>

              <div class="space-y-2">
                <Label for="affected-system" size="sm">Affected product / system</Label>
                <Input id="affected-system" name="Affected system" type="text" required placeholder="Web app / API" size="md" />
              </div>

              <div class="space-y-2">
                <Label for="environment" size="sm">Environment</Label>
                <select id="environment" name="Environment" required class="w-full rounded-md border border-border bg-background px-3 py-2 text-foreground">
                  <option value="Production">Production</option>
                  <option value="Staging">Staging</option>
                  <option value="Unknown">Unknown</option>
                </select>
              </div>

              <div class="space-y-2">
                <Label for="vuln-type" size="sm">Vulnerability type</Label>
                <Input id="vuln-type" name="Vulnerability type" type="text" required placeholder="XSS, IDOR, SSRF..." size="md" />
              </div>

              <div class="space-y-2">
                <Label for="severity" size="sm">Severity (reporter estimate)</Label>
                <select id="severity" name="Severity" required class="w-full rounded-md border border-border bg-background px-3 py-2 text-foreground">
                  <option value="Low">Low</option>
                  <option value="Medium">Medium</option>
                  <option value="High">High</option>
                  <option value="Critical">Critical</option>
                </select>
              </div>

              <div class="space-y-2">
                <Label for="description" size="sm">Description</Label>
                <textarea id="description" name="Description" rows="4" required class="w-full rounded-md border border-border bg-background px-3 py-2 text-foreground" placeholder="Describe the vulnerability"></textarea>
              </div>

              <div class="space-y-2">
                <Label for="repro" size="sm">Reproduction steps</Label>
                <textarea id="repro" name="Reproduction steps" rows="4" required class="w-full rounded-md border border-border bg-background px-3 py-2 text-foreground" placeholder="Step-by-step reproduction"></textarea>
              </div>

              <div class="space-y-2">
                <Label for="impact" size="sm">Impact</Label>
                <textarea id="impact" name="Impact" rows="3" required class="w-full rounded-md border border-border bg-background px-3 py-2 text-foreground" placeholder="What could an attacker do?"></textarea>
              </div>

              <div class="space-y-2">
                <Label for="poc" size="sm">Proof of concept (links)</Label>
                <Input id="poc" name="Proof of concept" type="text" placeholder="Links, screenshots, or repos" size="md" />
              </div>

              <div class="space-y-2">
                <Label for="urls" size="sm">Affected URLs / endpoints</Label>
                <Input id="urls" name="Affected URLs" type="text" placeholder="https://app.example.com/endpoint" size="md" />
              </div>

              <div class="space-y-2">
                <Label for="date" size="sm">Date discovered</Label>
                <Input id="date" name="Date discovered" type="date" size="md" />
              </div>

              <label class="flex items-start gap-3 text-muted-foreground">
                <input type="checkbox" name="Good faith" required class="mt-1" />
                I confirm this report is made in good faith.
              </label>

              <div id="form-message" class="hidden"></div>

              <Button type="submit" variant="primary" size="lg" class="w-full" id="submit-button">
                Submit report
              </Button>
            </form>
          </CardContent>
        </Card>

        <h2>Safe Harbor</h2>
        <ul>
          <li>Make a good-faith effort to avoid privacy violations, data destruction, or service disruption.</li>
          <li>Only access data necessary to demonstrate the vulnerability.</li>
          <li>Report the vulnerability promptly and allow reasonable time for remediation.</li>
        </ul>
        <p><strong>Please do not:</strong></p>
        <ul>
          <li>Conduct denial-of-service testing.</li>
          <li>Access or modify other users’ data.</li>
          <li>Use social engineering, phishing, or physical attacks.</li>
        </ul>

        <h2>Scope</h2>
        <p><strong>In scope:</strong> Primero AI web applications, APIs, and services owned or operated by Primero AI.</p>
        <p><strong>Out of scope:</strong> Third-party services or integrations not owned by Primero AI.</p>

        <h2>Response Timeline</h2>
        <ul>
          <li>Acknowledgement within <strong>3 business days</strong></li>
          <li>Initial triage within <strong>7 business days</strong></li>
        </ul>

        <h2>Bounty Policy</h2>
        <p>At this time, Primero AI does <strong>not</strong> offer monetary rewards.</p>

        <p><strong>Last updated:</strong> January 27, 2026</p>
      </div>
    </article>
  </main>
  <Footer />
</BaseLayout>

<script>
  import { initContactForm } from "@/utils/contact-form";
  import { onDOMReady } from "@/utils/dom/dom-ready";

  onDOMReady(() => {
    const form = document.getElementById("vulnerability-form") as HTMLFormElement;
    if (form) {
      const instance = initContactForm(form);
      if (!instance) {
        console.error("Vulnerability form: Failed to initialize.");
      }
    } else {
      console.warn("Vulnerability form: Form element with id 'vulnerability-form' not found");
    }
  });
</script>
